<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>订单详情</title>
    <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no" />
    <meta name="format-detection" content="telephone=no" />
    <link rel="stylesheet" href="{{static_host}}/css/bootstrap.min.css">
    <link rel="stylesheet" href="{{static_host}}/css/alert.css">
    <link rel="stylesheet" href="{{static_host}}/css/jinping.css">
    <script src="{{static_host}}/jquery-3.1.1.min.js"type="text/javascript"></script>
    <script src="{{static_host}}/js/bootstrap.min.js"></script>
    <script src="{{static_host}}/react.min.js"></script>
    <script src="{{static_host}}/react-dom.min.js"></script>
    <script src="{{static_host}}/browser.min.js"></script>
    <script src="{{static_host}}/js/jinzhi.js"></script>
    <style media="screen">
        *{
            padding: 0;
            margin: 0;
          }
          html,body{
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
          }
          /*隐藏滚动条*/
          ::-webkit-scrollbar {
              display: none;
          }
          a{
            text-decoration: none;
            color: #fff;
          }
          #content{
              height: 100%;
          }
          .top{
           width: 100%;
           height: 47px;
           overflow: hidden;
           border-bottom: 1px solid #e7e7e7;
           box-shadow: 0 2px 5px #e7e7e7;
           background: #fff;
         }
         .top .back{
           width: 12.5333333%;
           height: 47px;
           float: left;
           display: inline-block;
           text-align: center;
           line-height: 47px;

         }
         .top .back img{
           width: 20px;
           height: 20px;
           vertical-align: middle;
         }
         .top .top-right{
           width: 12.5333333%;
           height: 47px;
           float: right;
           display: inline-block;
           text-align: center;
           line-height: 47px;
           position: relative;
         }
         .top .top-right p{
           display: inline-block;
		   display: none;
           width: 14px;
           height: 14px;
           line-height: 14px;
           color: #fff;
           position: absolute;
           left: 25px;
           top: 11px;
           font-size: 12px;
           background: #D81E06;
           border-radius: 50%;
           text-align: center;
         }
         .top .top-right img{
           width: 20px;
           height: 20px;
           vertical-align: middle;
         }
         .top .top-title{
           float: left;
           width: 74.93333333%;
           height: 47px;
           line-height: 47px;
           text-align: center;
           color: #252525;
           font-weight: 400;
         }
        .content{
          width: 100%;
          overflow: hidden;
        }
        .order-number{
          width: 100%;
          height: 30px;
          line-height: 30px;
          padding-left: 10px;
          font-size: 12px;
          border-bottom:1px solid #e8e8e8;
        }
        .Delivery-status{
          width: 100%;
          height: 35px;
          line-height: 35px;
          font-size: 12px;
          border-bottom:1px solid #e8e8e8;
        }
        .Delivery-status-img{
         width: 47px;
         display: inline-block;
         text-align: center;
        }
        .Delivery-wrap{
            overflow: hidden;
        }
        .Delivery-infor-wrap{
            float: left;
        }
        .Delivery-infor{
          text-align: center;

          width: 47px;
          height: 30px;
          line-height: 30px;
        }
        .Delivery-infor-bottom{
          float: left;
        }
        .Delivery-infor-bottom p{
            height: 30px;
            line-height: 30px;
            font-size: 12px;
            color: #706870;
            margin-bottom: 0;
        }
        .Delivery-status span:last-child{
          float: right;
          margin-right: 2.66667%;
        }
        .Delivery-status img{
            width: 15px;
            height: 15px;
        }
        .Delivery-infor-img{
          width: 15px;
          height: 15px;
        }


        .background{
          width: 100%;
          height: 10px;
          background: #EBEBEB;
        }
        .shop-infor{
          width: 90%;
          margin: 0 auto;
          height: 35px;
          line-height: 35px;
          overflow: hidden;
        }
        .shop-infor .shop-infor-img{
          margin-right:8.544px;
          line-height: 0;
          width: 16px;
          height: 17px;
          display: inline-block;
        }
        .shop-infor .shop-infor-img img{
          width: 100%;
          vertical-align: middle;
        }
        .content .shop-infor .span1{
          font-size: 14px;
          color: #999;
          vertical-align: middle;
          display: inline-block;
          margin-right: 5px;
        }
        .content .shop-infor span img{
          width: 15px;
          height: 15px;
          vertical-align: middle;
        }
        .content .shop-infor .span2{
          font-size: 14px;
          color: #F72E0A;
          vertical-align: middle;
          float: right;
          vertical-align: middle;
        }
        .content .product-infor{
          width: 100%;

          overflow: hidden;
          background: #f8f8f8;
          padding: 5px 0;
        }
        .content .product-infor .all{
          width: 90%;
          padding: 5px 0;
          overflow: hidden;
          margin: 0 auto;

        }
        .product-infor .product-infor-left{
          float: left;
          width: 15.11111%;
          height: 52px;
          margin-right: 2.962962%;
        }
        .product-infor .product-infor-left img{
          width: 51px;
          height: 52px;
        }
        .product-infor .product-infor-middle{
          float: left;
          width: 52.148148%;

        }
        .product-infor .product-infor-middle .p1{
          width: 100%;
          font-size: 14px;
          height: 35px;
          line-height: 17px;
          color: #223541;
          overflow: hidden;
          -webkit-line-clamp: 2;
          -moz-line-clamp: 2;
          -ms-line-clamp: 2;
          -o-line-clamp: 2;
          line-clamp: 2;
          -webkit-box-orient: vertical;
          -moz-box-orient: vertical;
          -ms-box-orient: vertical;
          -o-box-orient: vertical;
          box-orient: vertical;
          display: -webkit-box;
          display: -moz-box;
          display: -ms-box;
          display: -o-box;
          display: box;
          word-break: break-all;
        }
        .product-infor .product-infor-middle .p2{
          margin-top: 5px;
          color: #999;
          width: 100%;
          font-size: 12px;
          /*height: 30px;*/
          overflow: hidden;

        }
        .product-infor .product-infor-middle .p3{
          margin-top: 5px;
          width: 48px;
          font-size: 12px;
          display: inline-block;
          background: #ff5000;
          color: #fff;
          text-align: center;
        }
        .product-infor .product-infor-right{
          width: 29.6296296%;
          float: right;
        }
        .product-infor .product-infor-right p{
          width: 100%;
          text-align: right;
          line-height: 16px;
          text-overflow: ellipsis;
          white-space: nowrap;
          overflow: hidden;
          margin-bottom: 5px;
          font-size: 14px;
        }
        .product-infor .product-infor-right .tuikuan{
          color: #999;
        }
        .product-infor .product-infor-right p:first-child{
          width: 100%;
          text-align: right;
          line-height: 13px;
          color: #494949;
        }
        .product-infor .product-infor-right p:last-child{
          font-size: 12px;
        }


        .service{
          text-align: center;
          height: 40px;
          line-height: 40px;
        }
        .service img{
          width: 20px;
          height: 20px;
          vertical-align: middle;
        }
        .pay{
          width: 100%;
          height: 30px;
          line-height: 30px;
          font-size: 14px;
          color: #888;
        }
        .pay span:first-child{
          padding-left: 10px;
        }
        .pay span:last-child{
          float: right;
          padding-right:2.66667%;
        }
        .price span:last-child{
          color: #e51c23;
        }
        .real-price{

          padding-right:2.66667%;
          font-size:18px;
          height: 45px;
          line-height: 45px;
          color: #e51c23;
          font-weight: 600;
        }
        .real-price span{
          float: right;
        }
        .real-time{

          padding-right:2.66667%;
          font-size:14px;
          height: 35px;
          line-height: 35px;
          color: #888;
          font-weight: 600;
        }
        .real-time span{
          float: right;
        }
        .footer{
			width: 100%;
			background: #fff;
			position: fixed;
			bottom: 0;
			left: 0;
			right: 0;
        }
        .footer ul{
		  padding: 10px;
          display:-webkit-box;/* android 2.1-3.0, ios 3.2-4.3 */
          display:-webkit-flex;/* Chrome 21+ */
          display:-ms-flexbox;/* WP IE 10 */
          display:flex;/* android 4.4 */
          width: 96%;
          margin: 0 auto;
        }
        .footer ul li{
          flex: 1;
          width: 74px;
          height: 26px;
          line-height: 26px;
          list-style: none;
		  font-size: 14px;
        }
        .footer ul li p{
          width: 74px;
          background: #999;
          margin: 0 auto;
          border-radius: 3px;
          text-align: center;
        }
        .yuanjia{
          color: #999;
        }
        .order-time{
          padding: 10px 0;
        }
        .order-time p{
          width: 100%;
          text-indent: 10px;
          font-size: 12px;
          line-height: 16px;
          color: #A3A3A3;
          padding: 5px 0;
          margin: 0;
        }
        .Delivery-status a{
        color:#223541;
        text-decoration: none;
        }
        .footer ul li .last-p {
        background: #e84e40;
        }

        .service  a{
        color: #888;
        }
        .product-submit{
        border: 1px solid #eee;
        padding: 3px 6px;
        border-radius: 3px;
        }
    </style>
  </head>
  <body>
    <div id="content">
        <!-- 头部 -->
        <div class="top">
          <div class="back">
            <img src="{{static_host}}/images/jiantou.png" alt="">
          </div>
          <p class="top-title">订单详情</p>
          <div class="top-right"><a href="/messages"><img src="{{static_host}}/images/new3.png" alt=""><p class="headernewsnum"></p></a></div>
        </div>

        <!-- 中间 -->
        <div class="content">
          <div class="Delivery-wrap">
              <div class="Delivery-infor-wrap">
                  <div class="Delivery-infor">
                    <span><img src="{{static_host}}/images/person.png" alt="" class="Delivery-infor-img"></span>
                  </div>
                  <div class="Delivery-infor">
                    <span><img src="{{static_host}}/images/liulanlishi.png" alt="" class="Delivery-infor-img"></span>
                  </div>
              </div>
              <div class="Delivery-infor-bottom">
                <p>收货人: {{order.linkname}}{{order.mobile}} </p>
                <p>{{order.province}}{{order.city}}{{order.district}}{{order.detail_address}}</p>
              </div>
          </div>
          {% if !(order.order_status == "等待买家付款" || order.order_status == "付款确认中" || order.order_status == "交易关闭") %}
          <div class="Delivery-status">
            <a href="/check_logistics?order_id={{order.order_id}}">
                <span class="Delivery-status-img"><img src="{{static_host}}/images/address-img.png" alt="" class="Delivery-infor-img"></span>
                <span>{{logistics_info.detail_desc|safe}}</span>
                <span>
                    <img src="{{static_host}}/images/jiantou-right.png" alt="">
                </span>
            </a>
          </div>
          {% endif %}
          <div class="background"></div>
          <div class="shop-infor">
            <div class="shop-infor-img"><img src="{{static_host}}/images/shop.png" alt=""></div>
            <span class="span1">自营店</span><span><img src="{{static_host}}/images/jiantou-right.png" alt=""></span><span class="span2">{{order.order_status}}</span>
          </div>
    	  	{% for detail in details[order.order_id] %}
    	      <div class="product-infor" data-id="{{detail.product_id}}">
    	        <div class="all">
    	          <div class="product-infor-left">
    					 {% if products[detail.product_id].img %}
    					   <img src="{{products[detail.product_id].img.location}}" alt="">
    					 {% else %}
    						<img src="{{static_host}}/images/no_picture.png" alt="">
    					 {% endif %}
    			  </div>
    	          <div class="product-infor-middle">
    	            <p class="p1">{{products[detail.product_id].product_name}}</p>
    	            <p class="p2">{% if products[detail.product_id].color %}颜色:{{products[detail.product_id].color}}{% endif %}{% if products[detail.product_id].weight %}重量:{{products[detail.product_id].weight}}kg{% endif %}&nbsp;</p>
    	            <!-- <p class="p3">7天退换</p> -->
    	          </div>
    	          <div class="product-infor-right">
    	            <p>￥ {{detail.price}}</p>
    	            <p class="yuanjia"><s>￥{{detail.marketing_price}}</s></p>
    	            <p>x{{detail.number}}</p>
    	          </div>
    	        </div>
    	      </div>
     	  	{% endfor %}


          <div class="background"></div>
          <div class="service">
            <img src="{{static_host}}/images/mobile.png" alt=""><a href="tel:0513-81188090">联系客服</a>
          </div>
          <div class="pay">
            <span>支付方式</span>
            <span>{% if pay_info.length>0 %} {{pay_info[0].pay_way}} {% endif %}</span>
          </div>

          <div class="pay price">
            <span>商品价格：</span>
            <span>￥{{order.products_price}}</span>
          </div>
          <div class="pay">
            <span>运费：</span>
            <span>￥{{order.logistics_price}}</span>
          </div>
          <div class="pay">
            <span>备注：</span>
            <span>{{order.send_seller}}</span>
          </div>
          <div class="real-price">
            <span>实付款：￥{{order.actual_price}}</span>
          </div>

        </div>

        <!-- 订单创建时间 -->
        <div class="background"></div>
        <div class="order-time">
    	  <p>订单号：{{order.order_id}}</p>
          <p>支付交易号：{% if pay_info.length>0 %} {{pay_info[0].pay_log_id}} {% endif %}</p>
          <p>创建时间：{{order.created_at | date('Y-m-d H:i:s',-8*60)}}</p>
          <p>付款时间：{% if pay_info.length>0 %}{{pay_info[0].created_at_text}}{% endif %}</p>
          <p>发货时间：{{delivery_time}}</p>
          <p>承运公司：{{companies_map[order.type]}}</p>
        </div>
        <!-- 底部 -->
        <div class="footer">
          <ul>
                {% if order.order_status == "等待买家付款" %}
                    <li><a><p class="cancel_buy" data-id="{{order.order_id}}">不想买了</p></a></li>
                    <li><a href="pay_way?order_id={{order.order_id}}"><p>立即付款</p></a></li>
                {% elseif order.order_status=="付款确认中" %}
        			<li><a href="pay_way?order_id={{order.order_id}}"><p>继续付款</p></a></li>
        		{% elseif order.order_status=="等待卖家拣货" %}
                    <li><a href="/check_logistics?order_id={{order.order_id}}"><p>查看物流</p> </a></li>
        		{% elseif order.order_status=="等待卖家发货" %}
        			<li><a href="/check_logistics?order_id={{order.order_id}}"><p>查看物流</p> </a></li>
                {% elseif order.order_status=="等待快递员揽货" %}
            		<li><a href="/check_logistics?order_id={{order.order_id}}"><p>查看物流</p> </a></li>
        		{% elseif order.order_status=="卖家已发货" %}
        			<p class="product-submit">
        				<span>
        					<a href="/check_logistics?order_id={{order.order_id}}" style="color:#999;">查看物流</a>
        				</span>
        			</p>
        		{% elseif order.order_status=="等待买家收货" %}
        			<p class="product-submit">
        				<span>
        					<a href="/check_logistics?order_id={{order.order_id}}" style="color:#999;">查看物流</a>
        				</span>
        				<span {% if order.order_status=="等待买家收货" %} class="receive_product" {% endif %} data-id="{{order.order_id}}"> 确认收货</span>
        			</p>
        		{% elseif order.order_status=="交易成功" %}
                    <li><a><p class="delete_order" data-id="{{order.order_id}}">删除订单</p></a></li>
        		{% elseif order.order_status=="交易关闭" %}
                    <li><a><p class="delete_order" data-id="{{order.order_id}}">删除订单</p></a></li>
        		{% elseif order.order_status=="退款中订单" %}
                    <li><a><p>查看流程</p></a></li>
        		{% elseif order.order_status=="退款完成" %}
        			<li><a><p class="delete_order" data-id="{{order.order_id}}">删除订单</p></a></li>
        		{% endif %}
          </ul>
        </div>
    	<div style="width:100%;height:56px;background:#fff;"></div>
    </div>

	<script>
    	$(function() {
		$.ajax({
			url: "/check_message_number",
			dataType: 'json',
			type: 'POST',
			success: function(data) {
				if (data.count == 0) {
					$(".headernewsnum").hide();
				}else {
					$(".headernewsnum").show();
					$(".headernewsnum").html(data.count);
				}
			},
			error: function(xhr, status, err) {
			}
		});
		$(".top .back").click(function(){
			window.history.back();
		});
		$(".product-infor").click(function(){
			var product_id = $(this).data("id");
			location.href = "/product_show?product_id=" + product_id;
		});
        //取消订单
        $(".cancel_buy").click(function(){
            var order_id = $(this).data("id");
            var reason = "不想买了";
            var order_status = "未付款";
            $.post("/order_cancel",{order_id:order_id,reason:reason,order_status:order_status},function(data){
                if (data.success) {
                    location.href = "/order_detail?order_id="+order_id;
                }
            })
        });
        //删除订单
        $(".delete_order").click(function(){
            var order_id = $(this).data("id");
            $.post("/order_delete",{order_id:order_id},function(data){
                if (data.success) {
                    location.href = "/order_center";
                }
            })
        });
        //收货
        $(".receive_product").click(function(){
			var order_id = $(this).data("id");
			$.get("/receive_goods",{order_id:order_id},function(data){
				if (data.success) {
					location.href = "/order_detail?order_id="+order_id;
				}
			})
		});


    });
	</script>
  </body>
</html>
