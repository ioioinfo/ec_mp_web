<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no" />
    <meta name="format-detection" content="telephone=no" />
    <link rel="stylesheet" href="css/jinping.css">
    <link rel="stylesheet" href="css/reset.css">
    <link rel="stylesheet" href="css/search.css">
    <title>搜索内容</title>
    <style media="screen">
      @media screen and (max-width:640px){
        *{
          padding: 0;
          margin: 0;
        }
        html,body{
          width: 100%;
          height: 100%;
        }

        li{
          list-style: none;
        }
        a{
          color: #888888;
          text-decoration: none;
          font-size: 14px;
          display: inline-block;
        }
        /*隐藏滚动条*/
        ::-webkit-scrollbar {
            display: none;
        }
        .background{
          width: 100%;
          height: 50px;
          background: #fff;
        }
        #content{
            height: 100%;
        }
        /*头部搜索框*/
      .header{
          width: 100%;
          height: 36px;
          overflow: hidden;
        }
		.search{
		  width: 100%;
		  height:36px;
		  line-height: 36px;
		  background: rgb(112,180,44);
		  text-align: center;
		  position: relative;
		  overflow: hidden;
		}

		.searchfangdaImg{
		  position: absolute;
		  top: 10px;
		  left: 4.26829268%;
		}
		input::-webkit-input-placeholder {
		  color:    #fff;
		}
		input:-moz-placeholder {
		  color:    #fff;
		}
		input::-webkit-input-results {
		  color:    #fff;
		}
		input:-moz-results {
		  color:    #fff;
		}
		.headersearch{
		  display: inline-block;
		  width: 87.4666666%;
		  height: 25px;
		  line-height: 25px;
		  outline-style: none;
		  border: none;
		  background:  #44a338;;
		  border-radius: 6px;
		  text-indent: 36px;
          font-size: 12px;
          color: #fff;
		}
		.headernews{
		  display: inline-block;
		  width: 6.6666%;
		  height: 25px;
		  position: relative;
		}
		.headernewsnum{
		  position: absolute;
		  top: 6px;
		  left: 17px;
		  font-size: 12px;
		  font-weight: 400;
		  color: #EE0A08;
		  background: #fff;
		  width: 14px;
		  height: 14px;
		  line-height: 14px;
		  border-radius: 7px;
		  display: none;
		}
		.headernimg{
		  vertical-align: middle;
		  margin-left: 5px;
		  width: 20px;
		  height: 20px;
		}

        .word ul{
          width: 100%;
          display: flex;
          border: 1px solid #e8e1e8;
          box-sizing: border-box;
        }
        .word .word-next li{
          flex: 1;
          text-align: center;
          height: 45px;
          line-height: 45px;
        }
        .word-next .red a{
          color: #ff5722;
        }
        .word .word-next li span img{
          width: 12px;
          height: 12px;
        }
        .infor{
          width: 96%;
          margin: 20px auto 0;
        }
        .infor .infor-ul li{
          border-bottom: 1px solid #e8e1e8;
          padding-bottom: 6px;
        }
        .infor-left{
          width: 27.7777778%;
          height: 100px;
          display: inline-block;
          vertical-align: top;
        }
        .infor-left img{
          width: 100%;
          height: 100px;
        }
        .infor-right{
          display: inline-block;
          width: 67.111111%;

        }
        .infor-right .infor-right-one{
          width: 100%;
          line-height: 22px;
          font-size: 14px;
        }
        .infor-right .infor-right-two span{
          display: inline-block;
          background: #f4f4f4;
          font-size: 12px;
          padding: 4px 5px;
          margin: 0 10px 0 0;
          border-radius: 6px;
        }
        .infor-right-three{
          font-size: 16px;
          color: #e51c23;
          line-height: 28px;
        }
        .infor-right-four{
            height: 20px;
            line-height: 20px;
        }
        .infor-right-four span{
          border-radius: 4px;
          display: inline-block;

        }
        .infor-right-four span{
          padding: 0 4px;
          background: #ff7043;
          color: #fff;
          font-size: 12px;
          display: inline-block;

        }
        .infor-right-four span:nth-child(3n+2){
          padding: 0 14px;
        }

        /*筛选*/
        .shaixuan{
          width: 88%;
          height: 100%;
          position: fixed;
          top: 0;
          right: 0;
          bottom: 0;
          background:#fff;
          z-index: 2;
          display: none;
          overflow: auto;
        }
        .shaixuanline{
          width: 96%;
          margin: 0 auto;
          height:56px;
          line-height: 56px;
          border-bottom: 1px solid #E1E1E1;
        }
        .shaixuanline input::-webkit-input-placeholder {
          color:    #666;
        }
        .shaixuanline input:-moz-placeholder {
          color:    #666;
        }
        .shaixuanline input{
          width: 55px;
		  height: 23px;
		  line-height: 18px;
          text-align: center;
          outline-style: none;
		  border-color: #888;

        }

        .shaixuanlineInput{
          float: right;
        }
        .shaixuanlineblock{
          display: flex;
          /*justify-content: space-around;*/
          flex-wrap:wrap;


        }
        .shaixuanlineblock li{
          width: 32%;
          background: #F2F2F2;
          text-align: center;
          font-size: 14px;
          height: 30px;
          line-height: 30px;
          border-radius: 6px;
          margin-bottom: 18px;
		  margin-right: 1.262626%;
        }
        .shaixuanline1{
          height: auto;
          padding-bottom: 17px;
        }

        .shaixuan .shaixuanlineblock li.on {
          background:#FF5004;
        }
        .shaixuan .shaixuanlineblock li.on a {
          color: #fff;
        }

        /*遮罩层*/
        .zhezhaoceng{
          width: 100%;
          height: 100%;
          position: fixed;
          top: 0;
          left: 0;
          right: 0;
          bottom: 0;
          z-index: 1;
          background: #000;
          opacity: 0.5;
          display: none;
        }
        .shaixuan .shaixuansubmit{
          width: 88%;
          display: flex;
          position: fixed;
          bottom: 0;
          right: 0;
          right: 0;
        }
        .shaixuan .shaixuansubmit p{
          width: 50%;
          height: 46px;
          line-height: 46px;
          text-align: center;

          box-sizing: border-box;
        }
        .shaixuan .shaixuansubmit p:first-child{
          border-top: 1px solid #e7e7e7;
          background: #fff;
        }
        .shaixuan .shaixuansubmit p:last-child{
          background: #FF5004;
          color: #fff;
        }
		input::-webkit-input-placeholder {
        color:    #888;
       font-size: 12px;
      }
      input:-moz-placeholder {
          color:    #888;
         font-size: 12px;
      }
     .word .word-next li .jiantou img{
		 width: 10px;
		 height: 10px;
	 }
	 /*底部导航*/
     .footernav{
       width: 100%;
       height: 42px;
       display: flex;
       padding-top: 5px;
       padding-bottom: 5px;
       position: fixed;
       bottom: 0;
       left: 0;
       right: 0;
       background: #fff;
       border-top: 1px solid #eee;
     }
     .footernav li{
       width: 20%;
       height:42px;
       box-sizing: border-box;
       list-style: none;
       text-align: center;
       font-size: 14px;
     }
     .footernav li p{
    	 height: 22px;
    	 box-sizing: border-box;
     }
     .footernav li p img{
       width: 22px;
       height: 22px;
     }
     .footernav li:nth-child(5n+2) a{
    	 color: #d81e06;
       }
       /*返回顶部*/
       .top{
         position: fixed;
         bottom: 56px;
         right: 8px;
         width: 35px;
         height: 35px;
         z-index: 20;
         display: none;
       }
       .top img{
         width: 35px;
         height: 35px;
       }
      }
    </style>
  </head>
  <body>
      <div id="content">
          <div class="search">
            <input  type="search" value="" placeholder="搜索" class="headersearch" />
            <span class="searchfangda"><img src="images/fangdajing.png" alt="" class="searchfangdaImg" /></span>
            <div class="headernews">
      		  <a href="/messages">
      	        <img src="images/new2.png" alt="" class="headernimg" />
      	        <span class="headernewsnum"></span>
      		  </a>
            </div>
          </div>
          <div class="word">
            <ul class="word-next">
              <li class="red"><a ><span>综合</span><span><img src="images/jiantou-down-2.png" alt=""></span></a></li>
              <li><a ><span>销量优先</span></a></li>
      		<li class="price"><a><span>价格</span><span><img src="images/jiantou-down-1.png" alt=""></span></a></li>
              <li class="word-nextshaixuan"><a ><span>筛选</span><span><img src="images/jiantou-down-1.png" alt=""></span></a></li>
            </ul>
          </div>
      	{% if products.length >0 %}
      		{% for product in products %}
      			<div class="infor">
      	      <ul class="infor-ul">
      	        <li>
      	          <a href="/product_show?product_id={{product.id}}">
      	            <div class="infor-left">
      	              <img class="loading" src="images/load.png" data-src="{{product.img.location}}" alt="">
      	            </div>
      	            <div class="infor-right">
      	              <p class="infor-right-one">{{product.product_name}}</p>
      	              <p class="infor-right-two">{% if product.weight %}<span>{{product.weight}}kg</span>{% endif %} {% if product.color %}<span>{{product.color}}</span>{% endif %}</p>
      	              <p class="infor-right-three">￥{{product.product_sale_price}}</p>
      	              <p class="infor-right-four"><span>南通</span>{% if comments[product.id] %}<span>{{comments[product.id].total_number}}条评论</span><span>好评率{{comments[product.id].good_rate_text}}</span>{% else %}<span>0条评论</span><span>好评率100%</span>{% endif %}</p>
      	            </div>
      	          </a>
      	        </li>
      	      </ul>

      	    </div>
      		{% endfor %}
      	{% else %}
      	    <div style="text-align:center;margin-top:271px;color:#999;">没有查询结果。</div>
      	{% endif %}
          <!-- 筛选 -->
          <div class="shaixuan">
      	  {% for saixuan in saixuans %}
      	      <div class="shaixuanline shaixuanline1">
      	        <span>{{saixuan.name}}</span><span class="shaixuanlineInput"><img src="images/jiantou-down-1.png" alt=""></span>
      	        <ul class="shaixuanlineblock shaixuanlineblock{{saixuan.number}}">
      			{% for val in saixuan.value %}
      			  <li data-name="{{saixuan.field_name}}" data-val="{{val}}" {% if select_saixuans[saixuan.field_name] == val %} class="on" {% endif %}><a>{{val}}</a></li>
      			{% endfor %}
      	        </ul>
      	      </div>
      	  {% endfor %}
            <div class="shaixuansubmit">
              <p class="shaixuanNo">重置</p>
              <p class="shaixuanYes">确定</p>
            </div>
            <div class="background"></div>
          </div>
          <!-- 遮罩层 -->
          <div class="zhezhaoceng"></div>

          <!-- 返回顶部 -->
      	<div class="top"><img src="images/scroll-to-top-icon.png" alt="" /></div>
        <!-- =================分割线   搜索弹出层================= -->
        <div class="SearchCeng">
            <div class="SearchCeng_top">
              <span class="goBack"><img src="images/jiantou.png" alt="" /></span>
              <input type="text" name="" value="" placeholder="搜索" class="SearchCengInput">
              <span class="SearchCeng_top_no">取消</span>
            </div>
            <p class="word">大家都在搜</p>
            <div class="SearchCeng_infor">
                <span><a href="/search?q=礼服">礼服</a></span>
                <span><a href="/search?q=棒球服">棒球服</a></span>
                <span><a href="/search?q=孕妇裤">孕妇裤</a></span>
                <span><a href="/search?q=休闲鞋">休闲鞋</a></span>
                <span><a href="/search?q=板鞋">板鞋</a></span>
                <span><a href="/search?q=电动车">电动车</a></span>
                <span><a href="/search?q=手提包">手提包</a></span>
                <span><a href="/search?q=行车记录仪">行车记录仪</a></span>
                <span><a href="/search?q=礼品袋">礼品袋</a></span>
                <span><a href="/search?q=移动电源">移动电源</a></span>
            </div>
        </div>
      </div>
    <script src="js/jquery-3.1.1.min.js"></script>
    <script src="js/jinzhi.js"></script>
	<script>
	$(function() {
		//页面显示消息
		$.ajax({
			url: "/check_message_number",
			dataType: 'json',
			type: 'POST',
			success: function(data) {
				$(".headernewsnum").show();
				$(".headernewsnum").html(data.count);
				if (data.count == 0) {
					$(".headernewsnum").hide();
				}
			},
			error: function(xhr, status, err) {
			}
		});
		var object = {{search_object | safe}};
		var change_url = function(){
			var arr = [];
			var url = "/search?";
			if (object.sort_id) {
				arr.push("sort_id=" + object.sort_id);
			}
			if (object.q) {
				arr.push("q=" + object.q);
			}
			if (object.is_new) {
				arr.push("is_new=" + object.is_new);
			}
			if (object.row_materials) {
				arr.push("row_materials=" + object.row_materials);
			}
			if (object.size_name) {
				arr.push("size_name=" + object.size_name);
			}
			if (object.sort) {
				arr.push("sort=" + object.sort);
			}
			return url+arr.join("&");
		};
		//价格排序
		$(".price").click(function(){
			if ("{{products}}" == "") {
				alert("当前没有商品供排序！");
				return;
			}
			if (object.sort == "price_desc") {
				object.sort = "price_asc";
			} else {
				object.sort = "price_desc";
			}
			location.href = change_url();
		});
		//滚动显示
		$(".headersearch").val(object.q);
		var docTop = $(document).scrollTop();
		var height = $(window).height();
		$(window).scroll(function () {
			docTop = $(document).scrollTop();
			img_show();
		});
		var img_show = function(){
            if (object.sort && object.sort=="price_desc" || object.sort=="price_asc") {
                $(".word .word-next li").removeClass("red");
				$(".price").addClass("red");
			}
			$(".infor-left .loading").each(function(index) {
				var imgHeight = $(this).offset().top;
				if(height + docTop > imgHeight-100){
					var img = $(this).data("src");
					$(this).attr("src",img);
					$(this).removeClass("loading");
				}else {
					return false;
				}
			});
		};
		img_show();
		//筛选信息
		$(".word .word-nextshaixuan").click(function(){
			if ("{{saixuans | safe}}" == "") {
				alert("当前没有商品供筛选！");
				return;
			}
          $("body").css("height",$(window).height());
          $(".shaixuan").hide();
          $(".zhezhaoceng").hide();
          $(".shaixuan").show();
          $(".zhezhaoceng").show();
          $("body").css("overflow","hidden");

        });
		$(".zhezhaoceng").click(function(){
			$(".shaixuan").hide();
            $(".zhezhaoceng").hide();
		});
        $(".shaixuanYes").click(function(){
			$(".shaixuanlineblock li").each(function(key,value){
				var name = $(this).data("name");
				delete object[name];
			});
			$(".shaixuanlineblock li.on").each(function(key,value){
				var name = $(this).data("name");
				var value = $(this).data("val");
				object[name] = value;
			});
			location.href = change_url();
        });
        $(".shaixuan .shaixuanlineblock1 li").click(function(){
          $(".shaixuan .shaixuanlineblock1 li").removeClass("on");
          $(this).addClass("on");
        });
        $(".shaixuan .shaixuanlineblock2 li").click(function(){
          $(".shaixuan .shaixuanlineblock2 li").removeClass("on");
          $(this).addClass("on");
        });
        $(".shaixuan .shaixuanlineblock3 li").click(function(){
          $(".shaixuan .shaixuanlineblock3 li").removeClass("on");
          $(this).addClass("on");
        });
        $(".shaixuanNo").click(function(){
            $(".shaixuan .shaixuanlineblock li").removeClass("on");
        });


      // ================分割线==================搜索弹出层
      $(".headersearch").click(function(){
          $(".SearchCeng").show();
          $(".SearchCengInput").focus();
      });
      $(".SearchCengInput").keypress(function(e){
          var key = e.which;
            if (key == 13) {
                var q = encodeURI(e.target.value);
                location.href = "/search?q="+q;
            }
      });
      $(".SearchCeng_top_no").click(function(){
          $(".SearchCeng").hide();
      })

	})
	</script>

	<!-- 返回顶部 -->
	<script type="text/javascript">
	$(".top").click(function(){
		$('body,html').animate({scrollTop:0},400);
	})
	$(window).scroll(function(){
	  var topHeight=$(window).scrollTop();
	  if (topHeight>500){
		//当滚动条的位置处于距顶部1000像素以下时，就是大于1000象数时，跳转出现
		$(".top").fadeIn(250);
	  }else{ //否则就消失
		$(".top").fadeOut(250);
	  }

  });
	</script>
  </body>
</html>
