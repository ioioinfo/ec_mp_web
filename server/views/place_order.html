<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no" />
    <meta name="format-detection" content="telephone=no" />
    <title>填写订单</title>
    <style media="screen">
      @media screen and (max-width:640px){
        *{
          padding: 0;
          margin: 0;
        }
        html,body{
          margin: 0;
          padding: 0;
          width: 100%;
          height: 100%;
          position: relative;
        }
        p{
          padding: 0;
          margin: 0;
        }
        li{
          list-style: none;
        }
        a{
          text-decoration: none;
          color: #000;
        }
        span{
          color: #232326;
        }

        .head{
          width: 100%;
          height: 46px;
          font-size: 0;
          position: relative;
          overflow: hidden;
        }
        .jiantou{
          display: inline-block;
          width: 32px;
          position: absolute;
          left: 10px;
          top: 7px;
        }
        .title{
          display:block;
          width: 200px;
          line-height: 46px;
          font-size: 16px;
          margin: 0 auto;
          text-align: center;
        }
        .menu{
          width: 32px;
          display: inline-block;
          position: absolute;
          right: 10px;
          top: 13px;
        }
        .line{
          width: 100%;
          height: 6px;
          background: #bbbbbb;
          opacity: 0.5;
        }
        .white{
          width: 100%;
          height: 6px;
          background: #fff;
        }
        .min-line{
          width: 100%;
          height: 1px;
          background: #fff;
          margin: 0 auto;
        }
        .nav{
          width: 100%;
          display: none;
        }
        .nav ul{
          width: 100%;
          display: flex;
          text-align: center;
          background: #404042;
        }
        .nav ul li{
          flex: 1;
          height: 70px;
          font-size: 12px;

        }
        .nav ul li .nav-top{
          width:40px;
          height:30px;
          margin: 0 auto;
          text-align: center;
          line-height: 40px;
        }
        .nav ul li img{
          width:25px;
          height:25px;
          vertical-align: bottom;
        }
        .nav ul li .nav-bottom{
          display: inline-block;

          line-height: 40px;
        }
        .nav ul li .nav-bottom a{
          color: #fff;
        }
        .nav .nav-car{
          line-height: 57px;
          font-size: 12px;
          font-weight: bold;
          color: #fff;
        }
        .address{
          width: 96%;
          margin: 0 auto;
          position: relative;
        }
        .address .address-infor .address-infor-warp{
          width: 100%;
          line-height: 30px;
          position: relative;
        }
        .address .address-infor .address-infor-warp span{
          display: inline-block;
          font-size: 16px;
        }
        .address .address-infor .address-infor-warp .address-infor-name{
          font-weight: bold;
          position: absolute;
          left: 16px;
          top: 1px;
        }
        .address-infor .address-infor-right{
          display: inline-block;
          width: 100%;
          text-align: center;
        }
        .address-infor .address-infor-right span:last-child{
          padding-left: 10px;
          font-size: 12px;
          color: #ff5722;
        }
        .address-infor p{
          width: 100%;
          display: inline-block;
          line-height: 30px;
        }
        .address-infor p span img{
          width: 12px;
          height: 12px;
        }
        .address-infor p span{
          font-size: 14px;

        }
         .jiantou-right{
          display: inline-block;
          width: 9px;
          height: 16px;
          position: absolute;
          top: 40%;
          right: 10px;
        }
         .jiantou-right img{
          width: 9px;
          height: 16px;
        }
        /*商品详情*/
        .product-infor{
          width: 100%;
          margin-bottom: 25px;
          overflow: hidden;
          background: #fff;
          padding: 5px 0;
        }
        .product-infor .all{
          width: 96%;
          padding: 15px 0 5px 0;
          overflow: hidden;
          margin: 0 auto;
          border-bottom: 1px solid #eee;
        }
        .product-infor .p0{
          width: 100%;
          padding: 5px 0;
          overflow: hidden;
          background: #F5F5F5;
          font-size: 14px;
          text-indent: 2%;
        }
        .product-infor .product-infor-left{
          float: left;
          width: 27.77777%;
          height: 100px;
          margin-right: 2.77777%;

        }
        .product-infor .product-infor-left img{
          width: 100px;
          height: 100px;
        }
        .product-infor .product-infor-middle{
          float: left;
          width: 69.44444%;

        }
        .product-infor .product-infor-middle .p1{
          width: 100%;
          font-size: 14px;
          height: 35px;
          line-height: 17px;
          color: #223541;
          overflow: hidden;
          -webkit-line-clamp: 2;
          -moz-line-clamp: 2;
          -ms-line-clamp: 2;
          -o-line-clamp: 2;
          line-clamp: 2;
          -webkit-box-orient: vertical;
          -moz-box-orient: vertical;
          -ms-box-orient: vertical;
          -o-box-orient: vertical;
          box-orient: vertical;
          display: -webkit-box;
          display: -moz-box;
          display: -ms-box;
          display: -o-box;
          display: box;
          word-break: break-all;
        }
        .product-infor .product-infor-middle .p2{
          margin-top: 5px;
          font-size: 12px;
          padding: 5px 0;
          overflow: hidden;
        }
        .product-infor .product-infor-middle .p2 .p2-span1{
          color: #FF5810;
          margin-top: 5px;
          font-size: 12px;
          float: left;
        }
        .product-infor .product-infor-middle .p2 .p2-span2{
          color: #1296DB;
          margin-top: 5px;
          font-size: 12px;
          float: right;
        }
        .product-infor .product-infor-middle .p2 .p2-span2 img{
          width: 16px;
          height: 16px;
          vertical-align: middle;
        }
        .product-infor .product-infor-middle .p3{
          text-align: right;
          padding-top: 15px;
        }
        .product-infor .product-infor-middle .p3 img{
          width: 16px;
          height: 16px;

        }
        .poistion{
          display: inline-block;
          width: 9px;
          height: 16px;
          position: absolute;
          top: 40%;
          right: 17.5px;
        }
        .poistion img{
          width: 9px;
          height: 16px;
        }

        .invoice{
          width: 100%;
          line-height: 45px;
          overflow: hidden;
          background: #eee;
        }
        .invoice .public-name{
          display: inline-block;
          font-size: 16px;
          text-indent: 10px;
        }
        .invoice .add-num{
          float: right;
          margin-right: 17.5px;
        }
        .invoice .img{
          width: 9px;
          height: 16px;
          vertical-align: middle;
        }
        .invoice .add-num span:first-child{
          vertical-align: middle;
          padding-right: 10px;
        }
        .red{
          color: red;
          vertical-align: middle;
        }
        .input{
          display: block;
          width:94%;
          height: 35px;
          line-height:35px;
          border: none;
          /*border: 2px solid #ebe8eb;*/
          outline: none;
          -webkit-appearance : none ;
          margin: 10px auto 10px;
        }
        .footer{
          font-size: 0;
          position: fixed;
          bottom: 0;
          left: 0;
          right: 0;
          background: #fff;
          border-top:1px solid #eee;

        }
        .footer .footer-left .bottom1{
          display: inline-block;
          width: 15px;
          height:15px;
          background: url(images/circle.png) no-repeat 0 0;
          background-size: cover;
          vertical-align: middle;
          margin:0 6px;
        }
        .footer .footer-left .all{
          vertical-align: middle;
          font-size: 16px;

        }
        .footer .footer-left{
          width: 25%;
          height: 40px;
          display: inline-block;
          vertical-align: bottom;

        }
        .footer .footer-center{
          width: 50%;
          display: inline-block;
          vertical-align: middle;
          text-align: center;
        }
        .footer .footer-center p span{
          color: red;
        }
        .footer .footer-right{
          width: 25%;
          display: inline-block;
        }
        .footer-center .footer-center-top span{
          font-size: 16px;
          display: inline-block;
          line-height: 63px;


        }


        .footer-right{
          display: inline-block;
          width: 25%;
          text-align: center;
          line-height: 58px;
          background: #ff7043;

          vertical-align: bottom;
        }
        .footer-right span{
          color: #fff;
          font-size: 14px;
        }
        /*配送方式*/
        .partone{
          width: 94%;
          height:227px;
          background: #fff;
          position: fixed;
          top: 175px;
          left: 3%;
          right: 3%;
          border-top: 1px solid #eee;
          z-index: 99999999;
          display: none;

        }
        .partone p{
          width: 100%;
          margin: 0 auto;
          line-height: 20px;
          font-size: 16px;
          color: #000;
          overflow: hidden;
          text-indent: 10px;
          margin-top: 10px;
        }
        .partone .partone-p{
          font-size: 12px;
          color: #000;
          margin-top: 10px;
        }
        .partone p span:last-child{
          float: right;
          margin-top: 8px;
          margin-right: 27.5px;
        }
        .partone .close{
          position: absolute;
          bottom: 0;
          left: 0;
          right: 0;
          width: 100%;
          height: 36px;
          line-height: 36px;
          text-align: center;
          color: #EF6900;
          border-top: 1px solid #eee;
          background: #fff;
        }
        .partone .close3{
          width: 94%;
          height: 36px;
          line-height: 36px;
          text-align: center;
          color: #EF6900;
          border-top: 1px solid #eee;
          background: #fff;
		  position: fixed;
		  top: 366px;
        }
        .partone .close3 input{
          padding: 2px 9px;
          border: none;
          border-radius: 2px;
          color: #fff;
        }
        .partone .close3 input:first-child{
          background: #EF6900;
          margin-right: 100px;
        }
        .partone .close3 input:last-child{
          background: #D81E06;
          margin-left: 100px;
        }
        .product-number{
          font-size: 14px;
          margin-right: 10px;
        }
        .partone .partone3-p span:first-child{
          display: inline-block;
          width: 80%;
          overflow: hidden;
          text-indent: 0;
        }
        .partone .partone3-p span input{
          vertical-align: middle;
        }
        /*添加新地址*/
        .paetone1,.paetone2,.paetone3{
          z-index: 99999999;
        }
        .middle{

          font-size: 0;
          border-bottom: 1px solid #f8f5f5;
        }
        .middle .middle-shouhuoren{
          width: 96%;
          margin: 0 auto;
          padding: 10px 0;
          border-bottom: 1px solid #f8f5f5;
          overflow: hidden;
        }
        .middle .span1{
          display: inline-block;
          width: 18.66666%;
          font-size: 14px;

          line-height: 26px;
        }
        .middle .input1{
          width: 76.33334%;
          outline-style: none;
          border: none;
          line-height: 26px;
          float: right;
        }
        .middle .middle-shouhuoren p{
          display: inline-block;
          width: 76.33334%;
          font-size: 14px;
          text-align: right;
          float: right;
        }
        .middle .middle-shouhuoren p img{
          width: 20px;
          height: 20px;
          vertical-align: middle;
        }
        .middle .middle-shouhuoren p .span2{
          vertical-align: middle;
          margin-right: 10px;
          line-height: 26px;
          color: #999;
        }
        .middle .middle-shouhuoren .input2{
          width: 100%;
          height: 56px;
          outline-style: none;
          border: none;

        }
        .middle .middle-shouhuoren .input3{
          float: right;
          margin: 2px 2.77777% 0 0;

        }
        .middle .middle-shouhuoren .span3{
          display: inline-block;
          width: 37.66666%;
          font-size: 14px;
        }
        .bottom{
          padding: 10px 0;
          border: none;
        }
        .new-address{
          width: 94%;
          position: fixed;
          top: 70px;
          left: 3%;
          background: #fff;
          z-index: 9999999999;
          display: none;
        }
        .opacity{
          width: 100%;
          height: 150%;
          background: #000;
          opacity: 0.5;
          position: absolute;
          top: 0;
          z-index: 9999;
          display: none;
        }
        .sure-submit .input3:last-child{
          margin-right: 40px;
          padding: 3px 9px;
          border-radius: 3px;
          border: none;
        }
        .sure-submit .input3:first-child{
          border: none;
          background: #D81E06;
          color: #fff;
          padding: 3px 9px;
          border-radius: 3px;
        }
      }
    </style>
  </head>
  <body>
    <div class="head">
      <span class="jiantou"><img src="images/jiantou.png" alt=""></span>
      <span class="title">填写订单</span>
      <span class="menu"><img src="images/menu.png" alt=""></span>
    </div>
    <div class="line"></div>
    <div class="nav">
      <ul>
        <li>
          <a href="#">
            <p class="nav-top"><img src="images/shouye-4.png" alt=""></p>
            <p class="nav-bottom"><a href="#">首页</a></p>
          </a>
        </li>
        <li>
          <a href="#">
            <p class="nav-top"><img src="images/search-1.png" alt=""></p>
            <p class="nav-bottom"><a href="#">搜索</a></p>
          </a>
        </li>
        <li>
          <a href="#">
            <p class="nav-top"><img src="images/car-1.png" alt=""></p>
            <p class="nav-bottom"><a href="#">购物车</a></p>
          </a>
        </li>
        <li>
          <a href="#">
            <p class="nav-top"><img src="images/header-3.png" alt=""></p>
            <p class="nav-bottom"><a href="#">我的账户</a></p>
          </a>
        </li>
      </ul>
    </div>
	<div id="place_order">

	</div>
    <!-- 快递配送方式 -->
    <div class="partone partone0">
      <p>配送方式</p>
      <p class="partone-p"><span>快递 免邮</span><span><input type="checkbox" name="" value=""></span></p>
      <div class="close close0">
        关 闭
      </div>
    </div>
    <script src="http://apps.bdimg.com/libs/jquery/2.1.1/jquery.min.js"type="text/javascript"></script>

    <!-- 运费险 -->
    <div class="partone partone1">
      <p>运费险</p>
      <p class="partone-p"><span>卖家赠送，若确认收货前退货，可获保险赔付</span><span><input type="checkbox" name="" value=""></span></p>
      <div class="close close1">
        关 闭
      </div>
    </div>

    <!-- 优惠券 -->
    <div class="partone partone2">
      <p>优惠券</p>
      <p class="partone-p"><span>满100减10元（1张）</span><span><input type="checkbox" name="" value=""></span></p>
      <p class="partone-p"><span>满100减10元（1张）</span><span><input type="checkbox" name="" value=""></span></p>
      <div class="close close2">
        关 闭
      </div>
    </div>

    <!-- 选择地址 -->
	<div class="">

	</div>
    <div class="partone partone3" style="overflow:auto;" id="change_address">

    </div>

    <!-- 新建地址 -->
    <div class="opacity"></div>
    <div class="new-address">
      <div class="middle">
        <div class="middle-shouhuoren">
          <span class="span1">收货人</span><input type="text" name="" value="" class="input1">
        </div>
      </div>
      <div class="middle">
        <div class="middle-shouhuoren">
          <span class="span1">联系电话</span><input type="text"  name="" value="" class="input1">
        </div>
      </div>
      <div class="middle">
        <div class="middle-shouhuoren">
          <span class="span1">所在地区</span>
          <p><span class="span2">请选择</span><span><img src="images/jiantou-right.png" alt=""></span></p>
        </div>
      </div>
      <div class="middle">
        <div class="middle-shouhuoren">
          <span class="span1">街道</span><p><span class="span2">请选择</span><span><img src="images/jiantou-right.png" alt=""></span></p>
        </div>
      </div>
      <div class="middle">
        <div class="middle-shouhuoren">
          <textarea  placeholder="详细地址" class="input2"></textarea>
        </div>
      </div>
      <div style="width:100%;height:10px;background:#f8f5f5"></div>
      <div class="middle bottom">
        <div class="middle-shouhuoren">
          <span class="span3">设置为默认地址</span><input type="checkbox" name="" value="" class="input3">
        </div>
        <div class="middle-shouhuoren sure-submit">
          <input type="submit" name="" value="确 定" class="input3">
          <input type="submit" name="" value="取 消" class="input3">

        </div>
      </div>
    </div>
    <script type="text/javascript">
      $(function(){

      });
    </script>
    <!-- nav点击显示隐藏 -->
    <script type="text/javascript">
      $(".head .menu").click(function(){
        $(".nav").toggle();
      })
    </script>
	<script src="js/lodash.min.js" type="text/javascript"></script>
	<script id="change_address_infos" type="text/template">
		<p>更换地址</p>
		<% _.forEach(addresses, function(address) {  %>
			<p class="partone-p partone3-p">
			  <span><%- address.detail_address %> &nbsp;<%- address.mobile %>&nbsp;<%- address.linkname %></span><span>
			  <input type="checkbox" name="" value="<%- address.address_id %>" data-id="<%- address.address_id %>" class="selected"></span>
			</p>
		<% }); %>
		<p class="partone-p partone3-p" style="height:37px;">
		  <span></span><span>
		  </span>
		</p>
		<div class="close3">
		  <input type="submit" name="" value="新 建" class="submit1">
		  <input type="submit" name="" value="确 定" class="submit2">
		</div>
	</script>
	<script id="place_order_infos" type="text/template">
		<div class="address">
		  <div class="address-infor">
			<div class="address-infor-warp"><span class="address-infor-name" data-id="<%- address.linkname %>"><%- address.linkname %></span><p class="address-infor-right"><span class="address-infor-mobile" data-id="<%- address.mobile %>"><%- address.mobile %></span><span>默认</span></p></div>
			<p><span><img src="images/address.png" alt=""></span><span class="address-infor-address" data-id="<%- address.detail_address %>"><%- address.detail_address %></span></p>
			<input value="<%- address.province %>" style="display:none;" class="address_province">
			<input value="<%- address.city %>" style="display:none;" class="address_city">
			<input value="<%- address.district %>" style="display:none;" class="address_district">
		  </div>
		  <span class="jiantou-right"><img src="images/jiantou-right.png" alt=""></span>
		</div>
		<div class="line"></div>
		<div class="white"></div>
		<div class="product-infor">
		  <p class="p0">2017-2-15</p>
		  <% _.forEach(shopping_carts, function(shopping_cart) {  %>
			  <div class="all">
				<div class="product-infor-left">
					<% if(products[shopping_cart.product_id].img){ %>
						<img src="images/<%- products[shopping_cart.product_id].img.location %>" alt="">
					<% }else{ %>
						<img src="images/no_picture.png" alt="">
					<% } %>
				</div>
				<div class="product-infor-middle">
				  <p class="p1"><%- products[shopping_cart.product_id].product_name %></p>
				  <p class="p2"><span class="p2-span1">￥<%- shopping_cart.total_prices %></span><span class="p2-span2">分享 <img src="images/share.png" alt=""></span></p>
				  <p class="p3">x<%- shopping_cart.total_items %></p>
				</div>
			  </div>
			<% }); %>
		</div>

		<div class="invoice">
		  <span class="public-name">发票信息</span>
		  <p class="add-num"><span>电子发票-个人</span><span><img src="images/jiantou-right.png" alt="" class="img"></span></p>
		</div>
		<div class="min-line"></div>
		<div class="invoice">
		  <span class="public-name">配送方式</span>
		  <p class="add-num click1"><span>快递免邮</span><span><img src="images/jiantou-right.png" alt="" class="img"></span></p>
		</div>
		<div class="min-line"></div>
		<div class="invoice">
		  <span class="public-name">运费险</span>
		  <p class="add-num click2"><span>请选择</span><span><img src="images/jiantou-right.png" alt="" class="img"></span></p>
		</div>
		<div class="min-line"></div>
		<div class="invoice">
		  <span class="public-name">优惠券</span>&nbsp<span style="color:red;">0张可用</span>
		  <p class="add-num click3"><span>请选择</span><span><img src="images/jiantou-right.png" alt="" class="img"></span></p>
		</div>
		<div class="min-line"></div>
		<div class="invoice">
		  <span class="public-name">商品金额</span>
		  <p class="add-num"><span class="product-number">共<%- total_data.total_items %>件</span><span class="red">￥<%- total_data.total_prices %></span></span></p>
		</div>
		<div class="invoice">
		  <span class="public-name">运费</span>
		  <p class="add-num"><span class="red">￥<%- total_data.lgtic_pay %></span><span class="img"></span></p>
		</div>
		<div class="min-line"></div>
		<div class="leave">
		  <span style="margin-top:20px;display:inline-block;text-indent:10px;">买家留言：</span>
		  <input type="text" name="" value="" placeholder="选填：对本次交易的说明" class="input" id="send_seller">
		</div>
		<div class="invoice">
		  <span class="public-name">可用积分：</span><span>100</span>
		  <p class="add-num"><span class="img"><input type="checkbox" name="" value=""></span></p>
		</div>
		<div class="invoice">
		  <span class="public-name">朋友代付</span><span>100</span>
		  <p class="add-num"><span class="img"><input type="checkbox" name="" value=""></span></p>
		</div>
		<div style="width:100%;height:68px;background:#fff;"></div>
		<div class="footer">
		  <div class="footer-left">
			<span class="bottom1"></span>
			<span class="all">全选</span>
		  </div>
		  <div class="footer-center">
			<p class="footer-center-top"><span>合计：</span><span>￥</span><span><%- total_data.total_prices+total_data.lgtic_pay %> </span></p>

		  </div>

		  <div class="footer-right">
			<span>去结算</span><span>(1)</span>
		  </div>
		</div>
	</script>
	<script>
		$(function() {
			var address = {
				"linkname"     : "",
				"mobile"   : "",
				"detail_address" : "",
				"province" : "",
				"city"	   : "",
				"district" : ""
			};
			var shopping_carts = {{shopping_carts|safe}};
			var products = {{products|safe}};
			var addresses = {{addresses|safe}};
			for (var i = 0; i < addresses.length; i++) {
				if (addresses[i].is_default ==1) {
					address = addresses[i];
				}
			}
			var invoices = {{invoices|safe}};
			var total_data = {{total_data|safe}};
			var place_order = function(){
				var t = _.template($("#place_order_infos").html());
				$("#place_order").html(t({shopping_carts:shopping_carts,products:products,address:address,total_data:total_data}));
				$(".footer-right").click(function(){
					address = {};
					address.linkname =	$(".address-infor-name").data("id");
					address.mobile = $(".address-infor-mobile").data("id");
					address.detail_address = $(".address-infor-address").data("id");
					address.province = $(".address_province").val();
					address.city = $(".address_city").val();
					address.district = $(".address_province").val();
					var send_seller = $("#send_seller").val();
					$.post("/order_save",{total_data:JSON.stringify(total_data),shopping_carts:JSON.stringify(shopping_carts),address:JSON.stringify(address),send_seller:send_seller},function(data){
						if (data.success) {
							alert("结算成功！");
						}else {
							alert(data.message);
						}
					});
				});
				//地址选择
				$(".address").click(function(){
					var t = _.template($("#change_address_infos").html());
					$("#change_address").html(t({addresses:addresses}));
					$(".partone3").css("display","block");
					$(".opacity").css("display","block");
					$(".submit1").click(function(){
					  $(".partone3").animate({bottom:"-375px"},300);
					  $(".opacity").css("display","block");
					  $(".new-address").css("display","block");
					});
					$(".input3").click(function(){
					  // $(".opacity").css("display","none");
					  $(".new-address").css("display","none");
					})
					//确认
					$(".close3 .submit2").click(function(){
						$(".partone3").css("display","none");
						$(".opacity").css("display","none");
						var address_id;
						$.each($('.selected:checkbox:checked'),function(){
							address_id = $(this).data("id");
						});
						if (address_id) {
							for (var i = 0; i < addresses.length; i++) {
								if (addresses[i].address_id == address_id) {
									address = addresses[i];
									place_order();
								}
							}
						}
					});
					//selected选中事件
					$(".selected").click(function(){
						$(".selected").not($(this)).removeAttr("checked");
					});
		        });

				//配送方式
				$(".opacity").css("height",$(document).height());
		        $(".click1").click(function(){
		          $(".partone0").css("display","block");
		          $(".opacity").css("display","block");
		        });
		        $(".close0").click(function(){
		          $(".partone0").css("display","none");
		          $(".opacity").css("display","none");
		        });
				//运费险
				$(".click2").click(function(){
				  $(".partone1").css("display","block");
				  $(".opacity").css("display","block");
				});
				$(".close1").click(function(){
				  $(".partone1").css("display","none");
				  $(".opacity").css("display","none");
				});
				//优惠卷
				$(".click3").click(function(){
				  $(".partone2").css("display","block");
				  $(".opacity").css("display","block");
				});
				$(".close2").click(function(){
				  $(".partone2").css("display","none");
				  $(".opacity").css("display","none");
				});


			}
			place_order();
		});
	</script>
  </body>
</html>
