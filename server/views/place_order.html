<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no" />
    <!-- <script src="http://code.jquery.com/jquery-1.8.0.min.js"></script> -->
    <title>填写订单</title>
    <style media="screen">
      @media screen and (max-width:640px){
        *{
          padding: 0;
          margin: 0;
        }
        html,body{
          margin: 0;
          padding: 0;
          width: 100%;
          height: 100%;
        }
        p{
          padding: 0;
          margin: 0;
        }
        li{
          list-style: none;
        }
        a{
          text-decoration: none;
          color: #000;
        }
        span{
          color: #232326;
        }

        .head{
          width: 100%;
          height: 46px;
          font-size: 0;
          position: relative;
          overflow: hidden;
        }
        .jiantou{
          display: inline-block;
          width: 32px;
          position: absolute;
          left: 10px;
          top: 7px;
        }
        .title{
          display:block;
          width: 200px;
          line-height: 46px;
          font-size: 16px;
          margin: 0 auto;
          text-align: center;
        }
        .menu{
          width: 32px;
          display: inline-block;
          position: absolute;
          right: 10px;
          top: 13px;
        }
        .line{
          width: 100%;
          height: 6px;
          background: #bbbbbb;
          opacity: 0.5;
        }
        .white{
          width: 100%;
          height: 6px;
          background: #fff;
        }
        .min-line{
          width: 94%;
          height: 1px;
          background: #bbbbbb;
          margin: 0 auto;
        }
        .nav{
          width: 100%;
          display: none;
        }
        .nav ul{
          width: 100%;
          display: flex;
          text-align: center;
          background: #404042;
        }
        .nav ul li{
          flex: 1;
          height: 70px;
          font-size: 12px;

        }
        .nav ul li .nav-top{
          width:40px;
          height:30px;
          margin: 0 auto;
          text-align: center;
          line-height: 40px;
        }
        .nav ul li img{
          width:25px;
          height:25px;
          vertical-align: bottom;
        }
        .nav ul li .nav-bottom{
          display: inline-block;

          line-height: 40px;
        }
        .nav ul li .nav-bottom a{
          color: #fff;
        }
        .nav .nav-car{
          line-height: 57px;
          font-size: 12px;
          font-weight: bold;
          color: #fff;
        }
        .address{
          width: 96%;
          margin: 0 auto;
          position: relative;
        }
        .address .address-infor .address-infor-warp{
          width: 100%;
          line-height: 30px;
          position: relative;
        }
        .address .address-infor .address-infor-warp span{
          display: inline-block;
          font-size: 16px;
        }
        .address .address-infor .address-infor-warp .address-infor-name{
          font-weight: bold;
          position: absolute;
          left: 16px;
          top: 1px;
        }
        .address-infor .address-infor-right{
          display: inline-block;
          width: 100%;
          text-align: center;
        }
        .address-infor .address-infor-right span:last-child{
          padding-left: 10px;
          font-size: 12px;
          color: #ff5722;
        }
        .address-infor p{
          width: 100%;
          display: inline-block;
          line-height: 30px;
        }
        .address-infor p span img{
          width: 12px;
          height: 12px;
        }
        .address-infor p span{
          font-size: 14px;

        }
         .jiantou-right{
          display: inline-block;
          width: 9px;
          height: 16px;
          position: absolute;
          top: 40%;
          right: 10px;
        }
         .jiantou-right img{
          width: 9px;
          height: 16px;
        }
        .product{
          position: relative;
          width: 100%;
        }
        .circle{
          display: inline-block;
          width: 16px;
          height:16px;
          background: url(images/circle.png) no-repeat 0 0;
          background-size: cover;
          position: absolute;
          top: 32px;
          left: 6px;
        }
        .product-infor{
          width: 100%;
          margin: 0 auto;
          position: relative;
        }
        .product-infor .img img{
          width: 92px;
          height: 92px;
        }
        .product-infor span:first-child{
          margin-left: 30px;
        }
        .product-infor .name{
          display: inline-block;
          width:48%;
          vertical-align: top;
          font-size: 12px;
          line-height: 21px;
        }
        .poistion{
          display: inline-block;
          width: 9px;
          height: 16px;
          position: absolute;
          top: 40%;
          right: 17.5px;
        }
        .poistion img{
          width: 9px;
          height: 16px;
        }
        .num{
          width: 100%;
          line-height: 35px;
        }
        .num .num-name{
          display: inline-block;
          font-size: 16px;
          text-indent: 10px;
        }
        .num .add-num{
          float: right;
          margin-right: 10px;
        }
        .num .add-num span{
          display: inline-block;
          line-height: 24px;
          padding: 0 10px;
          border: 1px solid #bbbbbb;
        }
        .num .add-num span:nth-child(3n+2){
          border-left: none;
          border-right: none;
        }
        .invoice{
          width: 100%;
          line-height: 45px;
          overflow: hidden;
        }
        .invoice .public-name{
          display: inline-block;
          font-size: 16px;
          text-indent: 10px;
        }
        .invoice .add-num{
          float: right;
          margin-right: 17.5px;
        }
        .invoice .img{
          width: 9px;
          height: 16px;
          vertical-align: middle;
        }
        .invoice .add-num span:first-child{
          vertical-align: middle;
          padding-right: 10px;
        }
        .red{
          color: red;
        }
        .input{
          display: block;
          width:94%;
          height: 32px;
          line-height: 32px;
          border: none;
          border: 2px solid #ebe8eb;
          outline: none;
          -webkit-appearance : none ;
          margin: 20px auto 40px;
        }
        .footer{
          font-size: 0;
          position: fixed;
          bottom: 0;
          left: 0;
          right: 0;
          background: #fff;
        }
        .footer .footer-left .bottom{
          display: inline-block;
          width: 20px;
          height: 20px;
          background: url(images/circle.png) no-repeat 0 0;
          vertical-align: middle;
          margin:0 6px;
        }
        .footer .footer-left .all{
          vertical-align: middle;
          font-size: 16px;

        }
        .footer .footer-left{
          width: 25%;
          height: 40px;
          display: inline-block;
          vertical-align: bottom;

        }
        .footer .footer-center{
          width: 50%;
          display: inline-block;
          vertical-align: middle;
          margin-top: 10px;
          text-align: center;
        }
        .footer .footer-center p span{
          color: red;
        }
        .footer .footer-right{
          width: 25%;
          display: inline-block;
        }
        .footer-center .footer-center-top span{
          font-size: 16px;
          display: inline-block;
          line-height: 58px;


        }


        .footer-right{
          display: inline-block;
          width: 25%;
          text-align: center;
          line-height: 58px;
          background: #ff7043;

          vertical-align: bottom;
        }
        .footer-right span{
          color: #fff;
          font-size: 14px;
        }
      }
    </style>
  </head>
  <body>
    <div class="head">
      <span class="jiantou"><img src="images/jiantou.png" alt=""></span>
      <span class="title">购物车</span>
      <span class="menu"><img src="images/menu.png" alt=""></span>
    </div>
    <div class="line"></div>
    <div class="nav">
      <ul>
        <li>
          <a href="#">
            <p class="nav-top"><img src="images/shouye-4.png" alt=""></p>
            <p class="nav-bottom"><a href="#">首页</a></p>
          </a>
        </li>
        <li>
          <a href="#">
            <p class="nav-top"><img src="images/search-1.png" alt=""></p>
            <p class="nav-bottom"><a href="#">搜索</a></p>
          </a>
        </li>
        <li>
          <a href="#">
            <p class="nav-top"><img src="images/car-1.png" alt=""></p>
            <p class="nav-bottom"><a href="#">购物车</a></p>
          </a>
        </li>
        <li>
          <a href="#">
            <p class="nav-top"><img src="images/header-3.png" alt=""></p>
            <p class="nav-bottom"><a href="#">我的账户</a></p>
          </a>
        </li>
      </ul>
    </div>
	<div id="place_order">


	</div>
	<script src="http://code.jquery.com/jquery-1.8.0.min.js"></script>
	<script src="js/lodash.min.js" type="text/javascript"></script>
	<script id="place_order_infos" type="text/template">
		<% _.forEach(addresses, function(address) {  %>
			<% if(address.is_default ==1) { %>
				<div class="address">
				  <div class="address-infor">
					<div class="address-infor-warp"><span class="address-infor-name"><%- address.linkname %></span><p class="address-infor-right"><span><%- address.mobile %></span><span>默认</span></p></div>
					<p><span><img src="images/address.png" alt=""></span><span><%- address.detail_address %></span></p>
				  </div>
				  <span class="jiantou-right"><img src="images/jiantou-right.png" alt=""></span>
				</div>
			<% } %>
		<% }); %>
		<div class="line"></div>
		<div class="white"></div>
		<% _.forEach(shopping_carts, function(shopping_cart) {  %>
			<div class="product">
		      <div class="circle"></div>
		      <div class="product-infor">
		        <span class="img"><img src="images/<%- products[shopping_cart.product_id].img.location %>" alt=""></span>
		        <span class="name">
					<a href="#">
						<%- products[shopping_cart.product_id].product_name %>&nbsp;
						单价：<%- products[shopping_cart.product_id].product_sale_price %>&nbsp;
						积分：<%- products[shopping_cart.product_id].product_sale_price %>&nbsp;
						总数：<%- shopping_cart.total_items %>&nbsp;
						总价：<%- shopping_cart.total_prices %>&nbsp;
						总重量：<%- total_data.total_weight %>g&nbsp;
					</a>
				</span>
		        <p class="poistion"><img src="images/jiantou-right.png" alt=""></p>
		      </div>
		      <div class="white"></div>
		      <div class="line"></div>
		      <div class="num">
		        <span class="num-name">购买数量</span>
		        <p class="add-num"><span>-</span><span><%- shopping_cart.total_items %></span><span>+</span></p>
		      </div>
		      <div class="line"></div>
		    </div>
		<% }); %>

		<div class="invoice" id="invoices">
		  <span class="public-name">发票信息</span>
		  <p class="add-num"><span>电子发票-个人</span><span><img src="images/jiantou-right.png" alt="" class="img"></span></p>
		</div>

		<div class="min-line"></div>
		<div class="invoice">
		  <span class="public-name">配送方式</span>
		  <p class="add-num"><span>快递免邮</span><span><img src="images/jiantou-right.png" alt="" class="img"></span></p>
		</div>
		<div class="min-line"></div>
		<div class="invoice">
		  <span class="public-name">运费险</span>
		  <p class="add-num"><span>请选择</span><span><img src="images/jiantou-right.png" alt="" class="img"></span></p>
		</div>
		<div class="min-line"></div>
		<div class="invoice">
		  <span class="public-name">优惠券</span>&nbsp<span style="color:red;">0张可用</span>
		  <p class="add-num"><span>请选择</span><span><img src="images/jiantou-right.png" alt="" class="img"></span></p>
		</div>
		<div class="min-line"></div>
		<div class="invoice">
		  <span class="public-name">商品金额</span>
		  <p class="add-num"><span class="red">￥<%- total_data.total_prices %></span><span class="img"></span></p>
		</div>
		<div class="invoice">
		  <span class="public-name">运费</span>
		  <p class="add-num"><span class="red">￥<%- total_data.lgtic_pay %></span><span class="img"></span></p>
		</div>
		<div class="min-line"></div>
		<div class="leave">
		  <input type="text" name="" value="" placeholder="给卖家留言" class="input">
		</div>
		<div class="invoice">
		  <span class="public-name">可用积分：</span><span><%- total_data.total_prices %></span>
		  <p class="add-num"><span class="img"><input type="checkbox" name="" value=""></span></p>
		</div>
		<div class="invoice">
		  <span class="public-name">朋友代付</span><span>100</span>
		  <p class="add-num"><span class="img"><input type="checkbox" name="" value=""></span></p>
		</div>
		<div style="width:100%;height:68px;background:#fff;"></div>
		<div class="footer">
		  <div class="footer-left">
			<span class="bottom"></span>
			<span class="all">全选</span>
		  </div>
		  <div class="footer-center">
			<p class="footer-center-top"><span>合计：</span><span>￥</span><span><%- total_data.total_prices+total_data.lgtic_pay %> </span></p>

		  </div>

		  <div class="footer-right">
			<span>去结算</span><span></span>
		  </div>
		</div>
	</script>
	<script>
		$(function() {
			var shopping_carts = {{shopping_carts|safe}};
			var products = {{products|safe}};
			var addresses = {{addresses|safe}};
			var invoices = {{invoices|safe}};
			var total_data = {{total_data|safe}};
			console.log(JSON.stringify(total_data));
			console.log(JSON.stringify(shopping_carts));
			var place_order = function(){
				var t = _.template($("#place_order_infos").html());
				$("#place_order").html(t({shopping_carts:shopping_carts,products:products,addresses:addresses,total_data:total_data}));
				$(".footer-right").click(function(){
					$.post("/order_save",{total_data:JSON.stringify(total_data),shopping_carts:JSON.stringify(shopping_carts)},function(data){
						if (data.success) {
							alert("结算成功！");
						}else {
							alert(data.message);
						}
					});
				});
			}
			place_order();
		});
	</script>
  </body>
</html>
